<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta name="Content-Type" content="text/html;charset=utf-8">
    <meta name="Referrer" content="unsafe-url">
    <meta content="True" name="HandheldFriendly">
    
    <meta name="theme-color" content="#18222d">
    
    
    <meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="detectify-verification" content="d0264f228155c7a1f72c3d91c17ce8fb" />
<meta name="p:domain_verify" content="b87e3b55b409494aab88c1610b05a5f0"/>
<meta name="alexaVerifyID" content="OFc8dmwZo7ttU4UCnDh1rKDtLlY" />
<meta name="baidu-site-verification" content="D00WizvYyr" />
<meta name="msvalidate.01" content="D9B08FEA08E3DA402BF07ABAB61D77DE" />
<meta property="wb:webmaster" content="f2f4cb229bda06a4" />
<meta name="google-site-verification" content="LM_cJR94XJIqcYJeOCscGVMWdaRUvmyz6cVOqkFplaU" />
<meta name="wwads-cn-verify" content="c8ffe9a587b126f152ed3d89a146b445" />
<script type="text/javascript" src="https://cdn.wwads.cn/js/makemoney.js" async></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5060390720525238"
     crossorigin="anonymous"></script>
    
    <title>腿夹腿，带你用 react 撸后台，系列二（项目骨架篇） - V2EX</title>
    <link rel="dns-prefetch" href="https://static.v2ex.com/" />
<link rel="dns-prefetch" href="https://cdn.v2ex.com/" />
<link rel="dns-prefetch" href="https://i.v2ex.co/" />
<link rel="dns-prefetch" href="https://www.google-analytics.com/" />    
    <style>
        body {
            min-width: 820px;
            font-family: "Helvetica Neue", "Luxi Sans", "Segoe UI", "Hiragino Sans GB", "Microsoft Yahei", sans-serif, "Apple Logo";
        }
    </style>
    <link rel="stylesheet" type="text/css" media="screen" href="/assets/041b65a587cf8204f8a8164b90cd8ceb5c14eb86-combo.css?t=1730203200">
    
    <link rel="stylesheet" type="text/css" media="screen" href="/assets/15cb944c4290ddc740fb131bcfe9cdfea20386a8-night.css?t=1730203200">
    <script>
        const SITE_NIGHT = 1;
    </script>
    <link rel="stylesheet" href="/static/css/vendor/tomorrow-night.css?v=b0e517e91324470337a008bd08305fec" type="text/css">
    
    <link rel="icon" sizes="192x192" href="/static/icon-192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon-180.png?v=91e795b8b5d9e2cbf2d886c3d4b7d63c">
    
    <link rel="shortcut icon" href="/static/favicon.ico" type="image/png">
    
    
    <link rel="manifest" href="/manifest.webmanifest">
    <script>
        const LANG = 'zhcn';
        const FEATURES = ['search', 'favorite-nodes-sort'];
    </script>
    <script src="/assets/68957da5f1064cfb0f0533e1417bfa3246e41c1e-combo.js?t=1730203200" defer></script>
    <meta name="description" content="分享创造 - @zhangfg - &amp;lt;p align=&#39;center&#39;&amp;gt;  &amp;lt;img width=&#39;320&#39; src=&#39;https://i-blog.csdnimg.cn/direct/5239ae895cf54b51b73b0f9">
    
    
    <link rel="canonical" href="https://www.v2ex.com/t/1084331">
    
    

<meta property="og:locale" content="zh_CN" />
<meta property="og:type" content="article" />
<meta property="og:title" content="腿夹腿，带你用 react 撸后台，系列二（项目骨架篇） - V2EX" />
<meta property="og:description" content="分享创造 - @zhangfg - &lt;p align='center'&gt;  &lt;img width='320' src='https://i-blog.csdnimg.cn/direct/5239ae895cf54b51b73b0f9" />
<meta property="og:url" content="https://www.v2ex.com/t/1084331" />
<meta property="og:site_name" content="V2EX" />

<meta property="article:tag" content="create" />
<meta property="article:section" content="分享创造" />
<meta property="article:published_time" content="2024-10-28T08:41:04Z" />

<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="分享创造 - @zhangfg - &lt;p align='center'&gt;  &lt;img width='320' src='https://i-blog.csdnimg.cn/direct/5239ae895cf54b51b73b0f9" />
<meta name="twitter:title" content="腿夹腿，带你用 react 撸后台，系列二（项目骨架篇） - V2EX" />
<meta name="twitter:image" content="https://cdn.v2ex.com/avatar/7896/28c9/533630_xlarge.png?m=1729737846" />
<meta name="twitter:site" content="@V2EX" />
<meta name="twitter:creator" content="@V2EX" />
<link rel="top" title="回到顶部" href="#">


<link rel="amphtml" href="https://www.v2ex.com/amp/t/1084331" />
<script>
const topicId = 1084331;
var once = "74353";

document.addEventListener("DOMContentLoaded", () => {
    protectTraffic();

    const observer = new IntersectionObserver(
        ([e]) => e.target.toggleAttribute('stuck', e.intersectionRatio < 1),
        {threshold: [1]}
    );

    observer.observe(document.getElementById('reply-box'));

    
    hljs.initHighlightingOnLoad();
    

    $('#Main').on('click', '.no, .ago', function () {
        location.hash = $(this).parents('.cell').prop('id');
    });

    

    autosize($('#reply_content'));

    $("#reply_content").textcomplete([{
        match: /(^|\s)@(\w*)$/,
        search: function (term, callback) {
            term = term.toLowerCase();
            var words = ['xyovo999', 'zhangfg'];
            callback($.map(words, function (word) {
                return word.toLowerCase().indexOf(term) === 0 ? word : null;
            }));
        },
        replace: function (value) {
            return '$1@' + value + ' ';;
        }
    }]);

    

    

    

    loadReplyDraft(1084331, 526173);

    $("#reply_content").on('input', function(e) {
        saveReplyDraft(1084331, 526173);
    });

    var keyPressed = 0;

    $("#reply_content").keydown(function(e) {
        keyPressed = keyPressed + 1;

        if ((e.ctrlKey || e.metaKey) && e.which === 13) {
            e.preventDefault();
            $("#reply_content").parent().submit();
        }
    });

    

    // refresh once
    document.addEventListener('visibilitychange', e => {
        if (document.visibilityState === 'visible') {
            fetchOnce().then(once => {
                $('#once').val(once);
            });
        }
    });

    if (location.search.indexOf('p=') > -1) {
    const p = Number(location.search.split('p=')[1].split('&')[0]);
    if (p) {
        const key = 'tp1084331';
        if (lscache.set(key, p, 60 * 24 * 30)) { // 30 days
            console.log(`Saved topic page number to ${key}: ` + p);
        }
    }
}
});
</script>
<script type="text/javascript">
function format(tpl) {
    var index = 1, items = arguments;
    return (tpl || '').replace(/{(\w*)}/g, function(match, p1) {
        return items[index++] || p1 || match;
    });
}
function loadCSS(url, callback) {
    return $('<link type="text/css" rel="stylesheet"/>')
        .attr({ href: url })
        .on('load', callback)
        .appendTo(document.head);
}
function lazyGist(element) {
    var $btn = $(element);
    var $self = $(element).parent();
    var $link = $self.find('a');
    $btn.prop('disabled', 'disabled').text('Loading...');
    $.getJSON(format('{}.json?callback=?', $link.prop('href').replace($link.prop('hash'), '')))
        .done(function(data) {
            loadCSS(data.stylesheet, function() {
                $self.replaceWith(data.div);
                $('.gist .gist-file .gist-meta a').filter(function() { return this.href === $link.prop('href'); }).parents('.gist-file').siblings().remove();
            });
        })
        .fail(function() { $self.replaceWith($('<a>').attr('href', url).text(url)); });
}
</script>

    
</head>
<body>
    
    <div id="Top">
        <div class="content">
            <div class="site-nav">
                <a href="/" name="top" title="way to explore"><div id="Logo"></div></a>
                <div id="search-container">
                    <input id="search" type="text" maxlength="128" autocomplete="off" tabindex="1">
                    <div id="search-result" class="box"></div>
                </div>
                <div class="tools" >
                
                    <a href="/" class="top">首页</a>
                    <a href="/member/azhu1990" class="top">azhu1990</a>
                    
                    <a href="/notes" class="top">记事本</a>
                    <a href="/t" class="top">时间轴</a>
                    
                    <a href="/settings" class="top">设置</a>
                    
                    <a href="#;" onclick="if (confirm('确定要从 V2EX 登出？')) { location.href= '/signout?once=74353'; }" class="top">登出</a>
                
                </div>
            </div>
        </div>
    </div>
    
    <div id="Wrapper" class="Night">
        <div class="content">
            
            <div id="Leftbar"></div>
            <div id="Rightbar">
                <div class="sep20"></div>
                
                    
                    <div class="box">
                        <div class="cell">
                            <table cellpadding="0" cellspacing="0" border="0" width="100%">
                                <tr>
                                    <td width="48" valign="top"><a href="/member/azhu1990"><img src="https://cdn.v2ex.com/avatar/cf29/05f8/526173_large.png?m=1730139325" class="avatar" border="0" align="default" width="48" style="width: 48px; max-height: 48px;" alt="azhu1990" /></a></td>
                                    <td width="10" valign="top"></td>
                                    <td width="auto" align="left"><div class="fr"><a href="/settings/night/toggle?once=74353" class="light-toggle"><img src="/static/img/toggle-dark.png" align="absmiddle" height="10" alt="Dark" /></a></div><span class="bigger"><a href="/member/azhu1990">azhu1990</a></span>
                                        
                                    </td>
                                </tr>
                            </table>
                            <div class="sep10"></div>
                            <table cellpadding="0" cellspacing="0" border="0" width="100%">
                                <tr>
                                    <td width="33%" align="center"><a href="/my/nodes" class="dark" style="display: block;"><span class="bigger">31</span><div class="sep3"></div><span class="fade">节点收藏</span></a></td>
                                    <td width="34%" style="border-left: 1px solid rgba(100, 100, 100, 0.4); border-right: 1px solid rgba(100, 100, 100, 0.4);" align="center"><a href="/my/topics" class="dark" style="display: block;"><span class="bigger">28</span><div class="sep3"></div><span class="fade">主题收藏</span></a></td>
                                    <td width="33%" align="center"><a href="/my/following" class="dark" style="display: block;"><span class="bigger">3</span><div class="sep3"></div><span class="fade">特别关注</span></a></td>
                                </tr>
                            </table>
                        </div>
                        <div class="cell" id="member-activity">
                            <div class="member-activity-bar">
                                <div class="member-activity-fourth" style="width: 92%;"></div>
                            </div>
                        </div>
                        <div class="cell flex-one-row" style="padding: 7px 10px;">
                            
                            <a href="/notifications" class="fade">0 未读提醒</a>
                            
                            
                            <div class="flex-one-row">
                                <div id="money"><a href="/balance" class="balance_area" style="">34 <img src="/static/img/silver@2x.png" height="16" alt="S" border="0" /> 56 <img src="/static/img/bronze@2x.png" height="16" alt="B" border="0" /></a></div>&nbsp;&nbsp;
                                <a href="/help/currency"><li class="fa fa-question-circle gray"></li></a>
                            </div>
                            
                        </div>
                        
                    </div>
                    <div class="sep"></div>
                    <div class="box">
                        
                        
                        
                        <div class="cell" style="padding: 8px; line-height: 100%;">
                            <table cellpadding="0" cellspacing="0" border="0" width="100%">
                                <tr>
                                    <td width="28"><a href="/write"><img src="/static/img/essentials/compose.png?v=b9e1f045f4ad639733bf9f6dbc62ed4c" width="28" border="0" style="vertical-align: bottom;" /></a></td>
                                    <td width="10"></td>
                                    <td width="auto" valign="middle" align="left"><a href="/write">创作新主题</a></td>
                                </tr>
                            </table>
                        </div>
                        
                        
                    </div>
                    
                    


    
    <div class="sep20"></div>
    <div class="box">
        <div class="inner" id="node_sidebar">
            <div class="sidebar_units">
</div>
爱意满满的作品展示区。
<style type="text/css">
#Wrapper {
background-image: url("/static/img/shadow_light.png"), url("//static.v2ex.com/grids/air.png");
background-repeat: repeat-x, repeat;
}

.box {
border-bottom: 1px solid #cdd8ff;
}
</style>
            
        </div>
        <div class="sidebar_compliance"><a href="/advertise" target="_blank">广告</a></div>
    </div>
    


                    
                    <div class="sep20"></div>
                    
<div style="box-sizing: border-box"><div class="wwads-cn wwads-vertical" data-id="98" style="max-width: 100%; padding-top: 20px; margin-top: 0px; text-align: left; box-shadow: 0 2px 3px rgb(0 0 0 / 10%); border-bottom: 1px solid var(--box-border-color); background-color: var(--box-background-color); color: var(--box-foreground-color);"></div></div>
<style type="text/css">.wwads-text { color: var(--link-color) !important; }</style>
                    <div class="sep20"></div>
                    
                    
                    
                
            </div>
            <div id="Main">
                <div class="sep20"></div>
                
<div class="box" style="border-bottom: 0px;">
    
    <div class="header"><div class="fr"><a href="/member/zhangfg"><img src="https://cdn.v2ex.com/avatar/7896/28c9/533630_xlarge.png?m=1729737846" class="avatar" border="0" align="default" width="73" style="width: 73px; max-height: 73px;" alt="zhangfg" /></a></div>
    <a href="/">V2EX</a> <span class="chevron">&nbsp;›&nbsp;</span> <a href="/go/create">分享创造</a>
    <div class="sep10"></div>
    <h1>腿夹腿，带你用 react 撸后台，系列二（项目骨架篇）</h1>
    <div id="topic_1084331_votes" class="votes">
<a href="javascript:" onclick="upVoteTopic(1084331);" class="vote"><li class="fa fa-chevron-up"></li> &nbsp;1</a> &nbsp;<a href="javascript:" onclick="downVoteTopic(1084331);" class="vote"><li class="fa fa-chevron-down"></li></a></div> &nbsp; <small class="gray"><a href="/member/zhangfg">zhangfg</a> · <span title="2024-10-28 16:41:04 +08:00">1 天前</span> · 787 次点击 &nbsp; </small>
    </div>
    
    
    
    <div class="cell">
        
        <div class="topic_content"><div class="markdown_body"><p>
<img class="embedded_image" loading="lazy" referrerpolicy="no-referrer" rel="noreferrer" src="https://i-blog.csdnimg.cn/direct/5239ae895cf54b51b73b0f9b46d5e025.png#pic_center"/>
</p>
<p><a href="https://github.com/diandian18/react-antd-console" rel="nofollow">Github 地址</a> | <a href="https://doc.react-antd-console.site" rel="nofollow">文档</a> | <a href="https://template.react-antd-console.site" rel="nofollow">在线预览</a> | <a href="https://react-antd-console.site" rel="nofollow">拓展 pro 版在线预览</a></p>
<p>
<img class="embedded_image" loading="lazy" referrerpolicy="no-referrer" rel="noreferrer" src="https://i-blog.csdnimg.cn/direct/7bc4d9d75c4543f19d211beacdafb7b8.png#pic_center"/>
</p>
<p><a href="https://github.com/diandian18/react-antd-console" rel="nofollow">react-antd-console</a> 是一个后台管理系统的前端解决方案，封装了后台管理系统必要功能（如登录、鉴权、菜单、面包屑等），帮助开发人员专注于业务快速开发。项目基于 <code>React 18</code>、<code>Ant design 5</code>、<code>Vite</code> 和 <code>TypeScript</code> 等新版本。对于使用到的各项技术，会被持续更新至最新版本。可放心用于生产环境。</p>
<p>为了方便大家更好的掌握和使用本项目，推出系列文章:</p>
<ul>
<li>腿夹腿，带你用 react 撸后台，系列一（ Vite 篇）</li>
<li>腿夹腿，带你用 react 撸后台，系列二（项目骨架篇）</li>
</ul>
<p>如果你喜欢这个项目或认为对你有用，欢迎使用体验和 <a href="https://github.com/diandian18/react-antd-console" rel="nofollow">Star</a></p>
<h2>1. 概述</h2>
<p>上篇我们搞定了构建工具，接下来，我们继续搭建项目骨架。值得一提的是，项目骨架搭建好后，会是一个通用的 react 开发模板，也可以用来开发其他 react 项目</p>
<h2>2. react 初始化</h2>
<p>上篇提到 <code>&lt;root&gt;/index.html</code> 引入了 <code>src/main.tsx</code>，接下来我们在 <code>&lt;root&gt;/index.html</code> 中添加一个 <code>div</code> 元素作为 react 根组件的容器</p>
<pre><code class="language-html">&lt;!-- &lt;root&gt;/index.html --&gt;
&lt;html&gt;
  &lt;body&gt;
    &lt;div id="root"&gt;&lt;/div&gt;
    &lt;script type="module" src="/src/main.tsx"&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>然后在 <code>src/main.tsx</code> 中初始化 react</p>
<pre><code class="language-tsx">// src/main.tsx
import { createRoot } from 'react-dom/client';
import App from './App';
// createRoot lets you create a root to display React components inside a browser DOM node.
const root = createRoot(document.getElementById('root')!);
root.render(
    &lt;App /&gt;
  );
</code></pre>
<p>参考文档：</p>
<ul>
<li><a href="https://zh-hans.react.dev/learn/add-react-to-an-existing-project#step-2-render-react-components-anywhere-on-the-page" rel="nofollow">React 官方文档-在页面的任何位置渲染 React 组件</a></li>
</ul>
<h2>3. react-router 初始化</h2>
<h3>3.1 准备工作</h3>
<p>在初始化 react-router 之前，我们先来考虑一些事情：</p>
<h4>3.1.1 一套配置生成多种数据</h4>
<p>众所周知，一个路由对应一个页面。
而侧边菜单，往往也是一个路由对应一个菜单项（除了一些特定的页面例如登录页/403 页等，和从某列表点开来的详情/编辑页等）。
而面包屑组件，也是根据菜单数据生成。
因此，我们需要只用一套数据，就可以自动生成 react 路由、菜单、面包屑等数据。</p>
<p>故作如下设计:</p>
<table>
<thead>
<tr>
<th>数据</th>
<th>类型</th>
<th>来源</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>routesConfig</td>
<td><code>RouteConfig[]</code></td>
<td>手动配置</td>
<td>配置路由</td>
</tr>
<tr>
<td>reactRoutes</td>
<td><a href="https://reactrouter.com/en/main/route/route#type-declaration" rel="nofollow"><code>RouteObject[]</code></a></td>
<td>自动生成</td>
<td>用于生成 <code>react-router</code> 路由</td>
</tr>
<tr>
<td>routes</td>
<td><code>RouteConfig[]</code></td>
<td>自动生成</td>
<td>树型结构，用于生成 <strong>菜单</strong>、<strong>面包屑</strong> 等数据</td>
</tr>
<tr>
<td>flattenRoutes</td>
<td><code>RouteConfig[]</code></td>
<td>自动生成</td>
<td><code>routes</code> 的展平数据结构，方便查询路由</td>
</tr>
</tbody></table><pre><code class="language-typescript">interface RouteConfig {
    /** 配置数据: 路径，同 react-router */
    path: string;
    /** 生成数据: 对应 react-router 的 pathname */
    pathname?: string;
    /**
     * 生成数据: ['', '/layout', '/layout/layout-children1',
     *  '/layout/layout-children1/permission']
     */
    collecttedPathname?: string[];
    /** 生成数据: ['', 'layout', 'layout-children1', 'permission'] */
    collecttedPath?: string[];
    /** 配置数据: 组件的文件地址 */
    component?: () =&gt; Promise&lt;any&gt;;
    /** 配置数据: 隐藏在菜单 */
    hidden?: boolean;
    /** 配置数据: 菜单名称 */
    name?: string;
    /** 配置数据: 菜单 icon */
    icon?: React.ReactNode;
    /** 配置数据: 页面标题，不传则用 name */
    helmet?: string;
    /** 配置数据: 菜单权限 */
    permission?: string;
    /** 配置数据: 重定向 path */
    redirect?: string;
    /** 配置数据: 将子路由的菜单层级提升到本级 */
    flatten?: boolean;
    /** 配置数据: 子路由，同 react-router */
    children?: RouteConfig[];
    /** 配置数据: 同 react-router */
    caseSensitive?: boolean;
    /** 配置数据: 是否是外链 */
    external?: boolean;
    /** 生成数据: 父路由 */
    parent?: RouteConfig;
};
</code></pre>
<p>为此，我们封装了 Router 类，导出在了 <a href="https://github.com/diandian18/react-router-toolset" rel="nofollow">react-router-toolset</a> 中。
react-router-toolset 还导出了 useRouter 方法，用于在 react 组件中获取最新的上述数据。</p>
<p>用法：</p>
<pre><code class="language-ts">// router/index.ts
import { Router } from 'react-router-toolset';
import { routesConfig } from './config';

/**
 * 路由配置在 `src/router/config/index.tsx` 文件的 `routesConfig` 中
 * routesConfig 要满足 RouteConfig 类型约束
 * routesConfig 配置参考:
 * https://github.com/diandian18/react-antd-console/blob/master/src/router/config/index.tsx
 */
const router = new Router(routesConfig);

// router 包含了 reactRoutes/routes/flattenRoutes 等数据
export default router;
</code></pre>
<h4>3.1.2 组件外跳转</h4>
<p>react-router 只提供了组件内跳转路由的 api <a href="https://reactrouter.com/en/main/hooks/use-navigate#usenavigate" rel="nofollow">useNavigate</a>。我们还希望在组件外可以跳转。而 <a href="https://github.com/remix-run/history" rel="nofollow">history</a> 是专门做这个事情的
另一方面，react-router 没有提供 history 模式的 Router 组件，我们需要封装一个</p>
<pre><code class="language-ts">// history.ts
import { createBrowserHistory } from 'history';
const history = createBrowserHistory();
export default history;
</code></pre>
<pre><code class="language-tsx">// HistoryRouter.tsx
import { useState, useLayoutEffect } from 'react';
import { Router } from 'react-router-dom';
import type { BrowserHistory } from 'history';

export interface HistoryRouterProps {
  history: BrowserHistory
  basename?: string
  children?: React.ReactNode
}

export default function HistoryRouter({
  basename,
  children,
  history,
}: HistoryRouterProps) {
  const [state, setState] = useState({
    action: history.action,
    location: history.location,
  });

  useLayoutEffect(() =&gt; history.listen(setState), [history]);

  return (
    &lt;Router
      basename={basename}
      location={state.location}
      navigationType={state.action}
      navigator={history}
    &gt;
      { children }
    &lt;/Router&gt;
  );
}
</code></pre>
<p>我们把 <code>history</code> 和 <code>HistoryRouter</code> 都导出在了 react-router-toolset 中</p>
<pre><code class="language-tsx">// router/index.ts
export * from 'react-router-toolset'; // 包括 history 和 HistoryRouter
</code></pre>
<pre><code class="language-ts">// 组件外跳转示例
import { history } from '@/router';
history.push('/login');
</code></pre>
<h3>3.2 初始化</h3>
<p>准备工作做好后，我们可以很简洁地初始化 react-router</p>
<pre><code class="language-tsx">// src/main.tsx
import { history, HistoryRouter } from '@/router';

root.render(
  &lt;HistoryRouter history={history}&gt;
    &lt;App /&gt;
  &lt;/HistoryRouter&gt;,
);
</code></pre>
<pre><code class="language-tsx">// src/App.tsx
import { useRoutes } from 'react-router-dom';
import router from '@/router';

function App() {
  const element = useRoutes(router.reactRoutes);
  return element;
}
</code></pre>
<h3>3.3 关于 react-router-toolset</h3>
<p>react-router-toolset 作为一个通用的 react-router 工具集，发布了 npm 包，<a href="https://github.com/diandian18/react-router-toolset" rel="nofollow">源码地址</a></p>
<p>下面额外介绍一些其他有用的方法:</p>
<pre><code class="language-ts">/**
 * 设置路由项。setItem
 * @param pathname 指定路由
 * @param cb 参数为 pathname 对应的路由
 */
Router.setItem: (pathname: string | ((routesConfigItem: RouteConfig) =&gt; void), cb?: (routesConfigItem: RouteConfig) =&gt; void) =&gt; void

/**
 * 设置 pathname 的兄弟路由
 * @param pathname 指定路由
 * @param cb 参数 routesConfigs 为 pathname 的兄弟路由
 * @param cb 参数 parentRoute 为 pathname 的父路由
 */
Router.setSiblings(pathname: string | ((routesConfig: RouteConfig[], parentRoute: RouteConfig) =&gt; void), cb?: (routesConfig: RouteConfig[], parentRoute: RouteConfig) =&gt; void): void

/**
 * 根据 pathname 获取 router 的 path
 * router 的 path 里可能有:id
 * @example '/123/home' -&gt; '/:id/home'
 */
Router.getRoutePath(pathname: string): string

/**
 * 根据当前路由 params
 * 替换掉目标 routePath 中的动态路由参数如":id"
 * @example '/:id/home' -&gt; '/123/home'
 */
(method) Router.getPathname(routePath: string): string

/**
 * 在 react 组件中获取最新的 reactRoutes/routes/flattenRoutes/curRoute
 */
function useRouter(router: Router): {
  reactRoutes: RouteObject[];
  routes: RouteConfig[];
  flattenRoutes: Map&lt;string, RouteConfig&gt;;
  curRoute: RouteConfig | undefined;
}
</code></pre>
<h2>4. 继续完善</h2>
<h3>4.1 动态浏览器标题</h3>
<p>每个页面都有自己的标题，我们希望在浏览器标题上动态展示页面对应的标题，可以使用 <a href="https://github.com/staylor/react-helmet-async" rel="nofollow">react-helmet-async</a> 实现</p>
<pre><code class="language-tsx">// src/App.tsx
import { Helmet, HelmetProvider } from 'react-helmet-async';
import router, { useRouter } from '@/router';

function App() {
  // useRouter 除了返回路由相关数据，还返回了当前路由数据
  const { curRoute } = useRouter(router);
  const element = useRoutes(router.reactRoutes);
  const { t: t_menu } = useTranslation('menu');

  return (
    &lt;HelmetProvider&gt;
      &lt;Helmet&gt;
        &lt;title&gt;{curRoute?.name ? `${t_menu(curRoute.name)} - ${DEFAULT_TITLE}` : DEFAULT_TITLE}&lt;/title&gt;
      &lt;/Helmet&gt;
      { element }
    &lt;/HelmetProvider&gt;
  );
}
</code></pre>
<h3>4.2 antd</h3>
<p><a href="https://ant.design/index-cn" rel="nofollow">antd</a> 甚至不用初始化，安装好直接用即可。</p>
<pre><code class="language-shell">npm i -S antd
</code></pre>
<p>打包的时候还能自动做 tree shaking （说是这么说，但是 antd 打出来的包依然很大。如果你嫌大，可以把 antd 做 cdn 引入。可以参考 <a href="https://github.com/mmf-fe/vite-plugin-cdn-import" rel="nofollow">vite-plugin-cdn-import</a> 和 <a href="https://rollupjs.org/configuration-options/#external" rel="nofollow">Vite 配置 build.rollupOptions.external</a> 去解决，在此不做展开）</p>
<p>值得一提的是，antd 功能覆盖的场景还是非常多的，很可能有一些很有用的功能，由于我们查看文档不够仔细而被忽略掉</p>
<p><a href="https://ant.design/index-cn" rel="nofollow">antd 文档</a>还是比较详细的，平时开发会经常用到，随时查阅，在此不做赘述</p>
<h3>4.3 请求</h3>
<p>可参考 <a href="https://doc.react-antd-console.site/development/request.html" rel="nofollow">react-antd-console 文档</a></p>
<h3>4.4 Mock</h3>
<p>可参考 <a href="https://doc.react-antd-console.site/development/mock.html" rel="nofollow">react-antd-console 文档</a></p>
<h3>4.5 国际化</h3>
<p>可参考 <a href="https://doc.react-antd-console.site/development/i18n.html" rel="nofollow">react-antd-console 文档</a></p>
<h2>5. 目录结构</h2>
<p>完成上述工作后，我们最后再确定下目录结构</p>
<pre><code class="language-shell">./src
├── assets      # 公共静态资源
├── components  # 公共组件
├── consts      # 公共常量
├── hooks       # 公共 hooks
├── http        # http
├── layouts     # 通用布局
├── locales     # 多语言配置
├── mock        # mock
├── models      # 公共数据管理
├── pages       # 页面组件
├── router      # 路由配置
├── services    # 接口配置
├── styles      # 公共样式
├── utils       # 公共工具
├── App.tsx     # 根组件
└── main.tsx    # 入口组件
</code></pre>
<p>下面从:</p>
<ul>
<li>固定目录(不需要修改)</li>
<li>配置目录</li>
<li>公共目录</li>
</ul>
<p>三种目录概述</p>
<h3>5.1 固定目录</h3>
<ul>
<li><code>src/lyaouts</code>: 通用布局。以后介绍</li>
<li><code>src/http</code>: 封装了 <code>axios</code>，配置了请求和响应拦截，导出了 <code>axios</code> 实例</li>
<li><code>src/mock</code>: 封装了 <code>msw</code>，若要添加 mock 文件，请在 <code>src/mock/browser.ts</code> 中添加</li>
</ul>
<h3>5.2 配置目录</h3>
<ul>
<li><code>src/router</code>: 包含路由配置和导出了一些重要的路由方法</li>
<li><code>src/pages</code>: 业务页面</li>
<li><code>src/locales</code>: 多语言配置</li>
<li><code>src/services</code>: 接口配置</li>
</ul>
<h3>5.3 公共目录</h3>
<p>以下目录，定义为通用目录，存放的都是可以复用的代码</p>
<ul>
<li><code>src/assets</code>: 公共静态资源</li>
<li><code>src/components</code>: 公共组件</li>
<li><code>src/consts</code>: 公共常量</li>
<li><code>src/hooks</code>: 公共 hooks</li>
<li><code>src/models</code>: 公共数据管理。以后介绍</li>
<li><code>src/styles</code>: 公共样式</li>
<li><code>src/utils</code>: 公共工具</li>
</ul>
<blockquote>
<p>逻辑相关性强的文件之间，应当尽可能的靠近，最好放在同一目录下。而公共目录，应当只包含：<strong>全局</strong>或<strong>可复用</strong>的代码</p>
</blockquote>
<blockquote>
<p>特别需要注意的是，除非由特殊原因，我们不认为每个<strong>页面</strong>组件都需要对应一个<strong>model</strong>数据，因为这么做会增加结构复杂度和维护难度。<strong>model</strong>中的数据，应该是一些<strong>全局</strong>或<strong>可复用</strong>的数据</p>
</blockquote>
<p>至此，项目骨架搭建完毕。</p>
<h2>6. 系列文章</h2>
<ul>
<li>腿夹腿，带你用 react 撸后台，系列一（ Vite 篇）</li>
<li>腿夹腿，带你用 react 撸后台，系列二（项目骨架篇）</li>
</ul>
<p>如果你喜欢这个项目或认为对你有用，欢迎使用体验和 <a href="https://github.com/diandian18/react-antd-console" rel="nofollow">Star</a></p>
<p><a href="https://github.com/diandian18/react-antd-console" rel="nofollow">Github 地址</a> | <a href="https://doc.react-antd-console.site" rel="nofollow">文档</a> | <a href="https://template.react-antd-console.site" rel="nofollow">在线预览</a> | <a href="https://react-antd-console.site" rel="nofollow">拓展 pro 版在线预览</a></p>
</div></div>
        
    </div>
    
    
    
    <div class="topic_buttons"><div class="fr topic_stats" style="padding-top: 4px;">787 次点击 &nbsp;∙&nbsp; 4 人收藏 &nbsp; </div><a href="/unfavorite/topic/1084331?once=74353" class="tb">取消收藏</a> &nbsp;<a href="#;" onclick="window.open('https://twitter.com/share?url=https://www.v2ex.com/t/1084331?r=azhu1990&related=v2ex&hashtags=create&text=✨+分享创造+·+腿夹腿，带你用 react 撸后台，系列二（项目骨架篇）', '_blank', 'width=550,height=370'); recordOutboundLink(this, 'Share', 'twitter.com');" class="tb">Tweet</a> &nbsp;<a href="#;" onclick="if (confirm('确定不想再看到这个主题？')) { location.href = '/ignore/topic/1084331?once=74353'; }" class="tb">忽略主题</a> &nbsp;<div id="topic_thank"><a href="#;" onclick="if (confirm('你确定要向本主题创建者发送谢意？')) { thankTopic(1084331, '74353'); }" class="tb">感谢</a></div></div>
</div>

<div class="sep20"></div>


<div class="box">
    <div class="cell"><div class="fr" style="margin: -3px -5px 0px 0px;"></div><span class="gray">3 条回复 &nbsp;<strong class="snow">•</strong> &nbsp;2024-10-28 17:31:41 +08:00</span>
    </div>
    

    
        
        <div id="r_15451559" class="cell">
        
        <table cellpadding="0" cellspacing="0" border="0" width="100%">
            <tr>
                <td width="48" valign="top" align="center"><img src="https://cdn.v2ex.com/avatar/7896/28c9/533630_large.png?m=1729737846" class="avatar" border="0" align="default" width="48" style="width: 48px; max-height: 48px;" alt="zhangfg" /></td>
                <td width="10" valign="top"></td>
                <td width="auto" valign="top" align="left"><div class="fr"><div id="thank_area_15451559" class="thank_area"><a href="#;" onclick="if (confirm('确认要不再显示来自 @zhangfg 的这条回复？')) { ignoreReply(15451559, '74353'); }" class="thank" style="color: #ccc;">隐藏</a> &nbsp; &nbsp; <a href="#;" onclick="if (confirm('确认花费 10 个铜币向 @zhangfg 的这条回复发送感谢？')) { thankReply(15451559); }" class="thank">感谢回复者</a></div> &nbsp; <a href="#;" onclick="replyOne('zhangfg');"><img src="/static/img/reply_neue_dark.png" align="absmiddle" border="0" alt="Reply" width="20" /></a> &nbsp;&nbsp; <span class="no">1</span></div>
                    <div class="sep3"></div>
                    <strong><a href="/member/zhangfg" class="dark">zhangfg</a></strong> &nbsp; <div class="badges"><div class="badge op">OP</div></div>&nbsp; &nbsp;<span class="ago" title="2024-10-28 16:51:48 +08:00">1 天前</span> 
                    <div class="sep5"></div>
                    <div class="reply_content">v.1.1.0 Latest<br /><br />New features:<br />- Dynamic route: Change route in any way.<br />- Dynamic meta: Change meta info in route.<br />- External link: Click external link will open a new brower tab and arrive the link.<br />- Separation layout: A empty layout.<br />- Single sider layout: Menu has no children.<br /><br />Fixed<br />- router.setSiblings has no effect on non-dynamic parameter prefix routes.</div>
                </td>
            </tr>
        </table>
        </div>
    
    

    
        
        <div id="r_15451792" class="cell">
        
        <table cellpadding="0" cellspacing="0" border="0" width="100%">
            <tr>
                <td width="48" valign="top" align="center"><img src="https://cdn.v2ex.com/avatar/b537/f3d4/687417_large.png?m=1729129416" class="avatar" border="0" align="default" width="48" style="width: 48px; max-height: 48px;" alt="xyovo999" /></td>
                <td width="10" valign="top"></td>
                <td width="auto" valign="top" align="left"><div class="fr"><div id="thank_area_15451792" class="thank_area"><a href="#;" onclick="if (confirm('确认要不再显示来自 @xyovo999 的这条回复？')) { ignoreReply(15451792, '74353'); }" class="thank" style="color: #ccc;">隐藏</a> &nbsp; &nbsp; <a href="#;" onclick="if (confirm('确认花费 10 个铜币向 @xyovo999 的这条回复发送感谢？')) { thankReply(15451792); }" class="thank">感谢回复者</a></div> &nbsp; <a href="#;" onclick="replyOne('xyovo999');"><img src="/static/img/reply_neue_dark.png" align="absmiddle" border="0" alt="Reply" width="20" /></a> &nbsp;&nbsp; <span class="no">2</span></div>
                    <div class="sep3"></div>
                    <strong><a href="/member/xyovo999" class="dark">xyovo999</a></strong> &nbsp; <div class="badges"></div>&nbsp; &nbsp;<span class="ago" title="2024-10-28 17:23:49 +08:00">1 天前</span> 
                    <div class="sep5"></div>
                    <div class="reply_content">做的不错 <a target="_blank" href="https://i.imgur.com/L62ZP7V.png" rel="nofollow noopener" target="_blank"><img src="https://i.imgur.com/L62ZP7V.png" class="embedded_image" rel="noreferrer"></a></div>
                </td>
            </tr>
        </table>
        </div>
    
    

    
        
        <div id="r_15451855" class="cell">
        
        <table cellpadding="0" cellspacing="0" border="0" width="100%">
            <tr>
                <td width="48" valign="top" align="center"><img src="https://cdn.v2ex.com/avatar/7896/28c9/533630_large.png?m=1729737846" class="avatar" border="0" align="default" width="48" style="width: 48px; max-height: 48px;" alt="zhangfg" /></td>
                <td width="10" valign="top"></td>
                <td width="auto" valign="top" align="left"><div class="fr"><div id="thank_area_15451855" class="thank_area"><a href="#;" onclick="if (confirm('确认要不再显示来自 @zhangfg 的这条回复？')) { ignoreReply(15451855, '74353'); }" class="thank" style="color: #ccc;">隐藏</a> &nbsp; &nbsp; <a href="#;" onclick="if (confirm('确认花费 10 个铜币向 @zhangfg 的这条回复发送感谢？')) { thankReply(15451855); }" class="thank">感谢回复者</a></div> &nbsp; <a href="#;" onclick="replyOne('zhangfg');"><img src="/static/img/reply_neue_dark.png" align="absmiddle" border="0" alt="Reply" width="20" /></a> &nbsp;&nbsp; <span class="no">3</span></div>
                    <div class="sep3"></div>
                    <strong><a href="/member/zhangfg" class="dark">zhangfg</a></strong> &nbsp; <div class="badges"><div class="badge op">OP</div></div>&nbsp; &nbsp;<span class="ago" title="2024-10-28 17:31:41 +08:00">1 天前</span> 
                    <div class="sep5"></div>
                    <div class="reply_content">@<a href="/member/xyovo999">xyovo999</a> 谢谢你😊</div>
                </td>
            </tr>
        </table>
        </div>
    
    


</div>
<div class="sep20"></div>






    
        
        <div class="box" id="reply-box">
    <div class="cell flex-one-row">
        <div>添加新回复</div>
        <div><a href="javascript:undockReplyBox();" id="undock-button">取消回复框停靠</a> &nbsp; &nbsp; <a href="#" onclick="goTop()">回到顶部</a></div>
    </div>
    <div class="cell"><form method="post" action="/t/1084331">
        <textarea name="content" maxlength="10000" class="mll" id="reply_content" onfocus="setReplyBoxSticky();"></textarea>
        <div class="flex-one-row" style="margin-top: 10px;">
            <input type="submit" value="回复" class="super normal button" />
            <input type="hidden" value="74353" id="once" name="once" />
            <input type="hidden" value="1" id="return_to_page" name="return_to_page" />
            <!--<span class="gray">请尽量让自己的回复能够对别人有帮助</span>-->
            <!--
            上面的这句话在这个位置存在了很久，在 2024 年 4 月 11 日这天夜里（11:25 PM PDT）被注释掉。

            一个地方如果有太多的标语，去告诉人们应该怎样、不应该怎样，是一件我在现在觉得很可悲的事情，但是在 2010 年左右时，却完全没有意识到。

            如果还有其他这样的标语，接下来也会逐渐去掉，V2EX 界面上的文字应该是尽量少的，我现在这样觉得。
            -->
        </div>
    </form></div>
    <div class="cell flex-row-end">
        <a href="/">← V2EX</a>
    </div>
</div>
        
    





<div class="sep20"></div>
<div class="box">
<div class="inner">
<div class="fr">







</div>

    
        <a href="#;" onclick="if (confirm('你确认需要报告这个主题？')) { location.href = '/report/topic/1084331?once=74353'; }">报告这个主题</a>
    
&nbsp;
</div></div>










            </div>
            
            
        </div>
        <div class="c"></div>
        <div class="sep20"></div>
    </div>
    <div id="Bottom">
        <div class="content">
            <div class="inner">
                <div class="sep10"></div>
                    <div class="fr">
                        <a href="https://www.digitalocean.com/?refcode=1b51f1a7651d" target="_blank"><div id="DigitalOcean"></div></a>
                    </div>
                    <strong><a href="/about" class="dark" target="_self">关于</a> &nbsp; <span class="snow">·</span> &nbsp; <a href="/help" class="dark" target="_self">帮助文档</a> &nbsp; <span class="snow">·</span> &nbsp; <a href="https://blog.v2ex.com/" class="dark" target="_blank">博客</a> &nbsp; <span class="snow">·</span> &nbsp; <a href="/help/api" class="dark" target="_self">API</a> &nbsp; <span class="snow">·</span> &nbsp; <a href="/faq" class="dark" target="_self">FAQ</a> &nbsp; <span class="snow">·</span> &nbsp; <a href="/tools" class="dark" target="_self">实用小工具</a> &nbsp; <span class="snow">·</span> &nbsp; 3264 人在线</strong> &nbsp; <span class="fade">最高记录 6679</span> &nbsp; <span class="snow">·</span> &nbsp; <a href="/select/language" class="f11"><img src="/static/img/language.png?v=6a5cfa731dc71a3769f6daace6784739" width="16" align="absmiddle" id="ico-select-language" /> &nbsp; Select Language</a>
                    <div class="sep20"></div>
                    创意工作者们的社区
                    <div class="sep5"></div>
                    World is powered by solitude
                    <div class="sep20"></div>
                    <span class="small fade">VERSION: 3.9.8.5 · 39ms · <a href="/worldclock#utc">UTC 12:02</a> · <a href="/worldclock#pvg">PVG 20:02</a> · <a href="/worldclock#lax">LAX 05:02</a> · <a href="/worldclock#jfk">JFK 08:02</a><br />Developed with <a href="https://cl.v2ex.pro/" target="_blank">CodeLauncher</a><br />♥ Do have faith in what you're doing.</span>
                <div class="sep10"></div>
            </div>
        </div>
    </div>

    
    
    

    

    
    <script src="/b/i/4bijb85OqISi4BSW-P38P3aOrRRh5J6ukLz_A5T5uetaf1tMdr2HR5cGI_5_KO7g_s_oNnMSO8TLpcI6xlZ1s0oLyauHxUY7SShsx4Bq-3hbsV8wnreBc6XEogvA0uFKOTZLu8SBhuhcSdJlYkpPjbzsx6ObmtoShqc3fZvVe4Ddp73ThIoi7h2JX_kmZoOh"></script>
    

    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-11940834-2', 'v2ex.com');
      ga('send', 'pageview');
      

ga('send', 'event', 'Node', 'topic', 'create');



    </script>
    

    
</body>
</html>